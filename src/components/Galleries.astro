---
import { supabase } from "../lib/supabase";
import GalleryCard from "./GalleryCard.astro";

interface Props {
  currentCategory?: string;
}

const { currentCategory } = Astro.props;

let categories: any[] = [];
try {
  const { data, error } = await supabase
    .from("images")
    .select("category, image_url, created_at")
    .order("category", { ascending: true })
    .order("created_at", { ascending: true });
  if (error) throw error;

  // カテゴリーごとの最初の画像のみ取得
  const uniqueCategories = new Map();
  data.forEach((item) => {
    if (!uniqueCategories.has(item.category)) {
      uniqueCategories.set(item.category, item.image_url);
    }
  });

  categories = Array.from(uniqueCategories.entries()).map(
    ([category, image_url]) => ({
      category,
      image_url,
    })
  );
} catch (error) {
  // console.error("Error fetching categories:", error.message);
}
---

<div>
  <h2>他のギャラリーも見る</h2>
  <div class="galleries">
    {
      categories
        .filter((category) => category.category !== currentCategory)
        .map((category) => (
          <GalleryCard
            title={category.category}
            link={`/Gallery/${category.category}`}
            image={category.image_url}
          />
        ))
    }
  </div>
</div>

<style>
  h2{
    font-size: 1.5rem;
    margin: 1rem 0;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid #000;
  }
  .galleries {
    display: flex;
    overflow-x: auto;
    white-space: nowrap;
    gap: 10px;
    padding: 10px;
  }

</style>
